---
date: 2022-09-18
---
# Text Scoreマニュアル

* TOC
{:toc}

## 概要
Text Scoreはテキストで記述した演奏命令に従って演奏を行うWebアプリケーションです。

以下のような機能があります。
- テキストによる演奏命令記述
  - 音符、次の音までの時間、長さ、音の強さで1音を表現
  - 同一パターンの繰り返し(ループ)
  - 演奏の一部をまとめて名前を付け、後から呼び出し(マクロブロック)
  - 選択追加により音符入力を行う入力補助
- 標準MIDI(GM)相当の音色選択(フリーのサウンドフォント使用)
- 複数楽器を重ね合わせたマルチトラックの楽曲作成

なお本Webアプリケーションは[科学へジャンプ・サマーキャンプ](http://jump2science.org/)におけるワークショップを念頭に開発しました。そのため画面読み上げソフトを用いた操作やパソコン操作に不慣れな利用者を想定し、画面上の要素やナビゲーションをその場で必要な最低限のものに絞っています。

## 動作環境
Text Scoreは以下の環境で動作を確認しています。
- Google Chrome 105以降
- Microsoft Edge 105以降

画面読み上げソフトはJAWSおよびNVDAでの動作を確認しています。PC-Talkerでも利用できることを想定していますが動作確認が不十分ですので、問題がありましたら開発者までご連絡ください。
その他のPC用ブラウザおよびモバイルブラウザでも利用できる可能性があります。

## お試し演奏機能
「お試し演奏」を使うと以下で説明する曲や楽器といったことを考えずに、とりあえず音を鳴らしてみることができます。

Text Scoreにログインしたら「お試し演奏」を選びます。するとすぐに楽譜の入力画面になります。入力したら「再生」を押すと楽譜が再生されます。

入力の仕方は次以降で説明する楽器の追加等の項目を参考にしてください。この画面では楽譜の保存はできません。

## 曲の作成から演奏まで
Text Scoreを用いて演奏命令を入力し、演奏させるまでの操作を説明します。詳細については[画面詳細説明](#pages)を参照してください。

### 曲の作成
Text Scoreにログインしたら「作曲開始」を選択します。すると「曲の作成」画面に移動します。

- 「題名」に適当な名前を入力します。
- 「テンポ」はそのままで問題ありません。
- 「保存」を選択します。曲の操作画面に移動します。

### 楽器の追加
曲の操作画面で「楽器を追加」を選択します。楽譜の編集画面に移動します。

まず「楽器」欄でお好みの楽器を選びます。ここでは「Acoustic Grand Piano」とします。

「入力ガイド」欄で以下のように操作して演奏命令を入力してみます。
- 音符「c4」、ステップ「48」を選択して「追加」をクリックします。
- 音符「g4」、ステップ「24」を選択して「追加」をクリックします。
- 音符「e4」、ステップ「24」を選択して、「追加」をクリックします。
- 音符「c4」、ステップ「96」を選択して、「追加」をクリックします。

これで「楽譜」欄には以下のような演奏命令が入力されます。
```
c4 48
g4 24
e4 24
c4 96
```

確認したら「保存」をクリックして演奏命令を保存します。

次に「再生」をクリックします。「ドーソミドーーー」というメロディーが再生されるはずです。

入力された演奏命令について少し説明します。「c4」「g4」などは音符で、最初のc, e, gはそれぞれド・ミ・ソを、次の4はオクターブの番号を示します。オクターブの番号は0から8まであります。
次の48, 24という数値はステップで、「次の音を鳴らすまでの時間」を示します。48が基準となり、四分音符の1拍に当たります。24はその半分の八分音符、96はその2倍の二分音符です。

ステップはある意味リズムを指定するものですが、入力ガイド欄には他に「長さ」もあります。これは音を伸ばしている時間で、鍵盤を押している時間に相当します。長さとして「-」を選ぶと、ステップと同じ時間だけ音を伸ばします。

ステップと長さを組み合わせていろいろなパターンを作ることができます。たとえばステップを0とすると次の音までの時間が0となり、結果二つの音を同時に鳴らすことができます。

### ドラムの追加
「曲に戻る」をクリックして曲操作画面に戻ります。続いて「ドラムを追加」をクリックして楽譜編集画面に移動します。

今回は入力ガイドを使わず、楽譜の入力欄に以下のように入力してみましょう。

```
(
36 12
38 12
38 12
38 12
) 3
49 48
```

入力したら「保存」をクリックし、「再生」を押して演奏させてみましょう。

数字で始まる各行は打楽器の一つの音に相当します。数値はガイド欄の「打楽器」により調べることができます。この例では36(バスドラム1)、38(アコースティックスネア)、49(クラッシュシンバル1)を利用しています。
二つ目の数字はステップで、12は1/4拍48は1拍を示しています。

「(」は繰り返し範囲の開始を示します。また「)」は繰り返し範囲の終了を示します。「)」に続く数字で繰り返し回数を示します。この例では四つの打楽器音からなる1拍のリズムを3回繰り返した後、シンバルを鳴らしています。

### 楽器の同時演奏
「曲に戻る」をクリックして曲操作画面に戻ります。

ここで「再生」を押してみましょう。先ほど入力したピアノとドラムが同時に演奏されることがわかります。

このようにしてText Scoreで曲を入力・演奏することができます。演奏命令の詳細については[演奏命令解説](#notations)を参照してください。

<a name="pages"></a>
## 画面詳細説明
### ログイン画面
管理者が設定したログインIDとパスワードを指定してログインします。
ログイン状態はブラウザを閉じても一定期間記録されます。必要に応じてメイン画面の「設定・ログアウト」よりログアウト操作を行ってください。

<a name="page_main"></a>
### メイン画面
ログイン後の画面で、作成した曲の一覧が表示されます。ここから新しい曲の作成を始めることができます。

- お試し演奏: 曲を作成せずに入力した楽譜を演奏させて試すことができます
- 作曲開始: 新しい曲を作成します。
- 設定・ログアウト: ログアウトおよびパスワード等の変更ができます。

<a name="page_instant_play"></a>
### お試し演奏画面
入力した楽譜を好みの楽器で演奏して試せる画面です。Text Scoreにまだ慣れていない時や、曲を作っていて何か試してみたい時に利用できます。

操作は[楽譜の編集画面](#page_track_edit)とほとんど同じです。違いは以下の点です。

- 「再生」を押すとすぐに入力した楽譜が再生されます。保存の必要はありません。
- 「クリアー」を押すと楽譜の内容が消えます。
- 「ドラムモード」にチェックを入れるとドラムのガイド入力と演奏ができます
- 入力した楽譜は保存できません。
- テンポを変更することはできません。

<a name="page_song_edit"></a>
### 曲の作成および編集画面
メイン画面から「作曲開始」を押した場合、またはすでにある曲から「曲情報の変更」を押した場合に表示されます。

- 題名: 曲の題名を設定します。メイン画面の一覧でわかりやすい名前を設定します。
- テンポ: 曲の速さを設定します。120が一般的な行進曲のテンポと言われています。

変更したら「保存」を押すことで設定が反映されます。

<a name="page_song_show"></a>
### 曲操作画面
作成した曲を再生したり各楽器の編集や新しい楽器の追加を行う画面です。

- 楽器を追加・ドラムを追加: 新しい楽器を追加して編集画面に移動します。
- 楽器○○を編集: 楽器ごとの演奏命令を[編集する画面](#page_track_edit)に移動します。
- 再生: 曲を演奏します。曲に含まれるすべての楽器を合わせた演奏となります。再生中は「再生」ボタンが「停止」ボタンに変わります。
- 曲情報の変更: [曲の編集画面](#page_song_edit)に移動します。
- その他の機能: [その他の機能画面](#page_song_show_extra)に移動します
- 曲の一覧へ: [メイン画面](#page_main)に移動します。

<a name="page_track_edit"></a>
### 楽譜の編集画面
演奏命令を編集し、演奏させて確認することができます。

- 楽器: 演奏させる楽器を変更することができます。
- 入力ガイド: 演奏命令のうちで音符情報の入力を簡単に行うことができます。
  - 音符: ドラム以外の場合に表示されます。演奏させたい音符を選択します。
  - 打楽器: ドラムの場合に表示されます。演奏させたい打楽器を選択します。
  - ステップ: 次の音までの時間を選択します。48を四分音符の1拍としています。
  - 長さ: 音を伸ばす長さを選択します。「-」の場合はステップと同じ時間だけ音を伸ばします。
  - 追加: 選択した音符を楽譜の入力欄に送ります。楽譜の入力欄でカーソルのある行の上に挿入されます。
- 楽譜: 演奏命令を入力する場所です。[演奏命令](#notations)の説明に従って入力します。
- 保存: 編集した内容を保存します。
- 再生: 保存した内容を演奏させます。編集を行ったらまず保存し、その後に再生するようにしてください。
- 曲に戻る: 楽器個別の編集画面から[曲の操作画面](#page_song_show)に戻ります。

なお、楽譜欄を空にして保存することでそのトラックを削除することができます。

<a name="page_song_show_extra"></a>
### その他の機能画面
[曲操作画面](#page_song_show)から「その他の機能」を選択した場合に表示されます。

現在以下の機能が利用できます。
- 楽器を選んで演奏: 楽器の横にあるチェックボックスで楽器を選びます。「再生」ボタンを押すと、選んだ楽器のみが演奏されます。
- ダウンロード: MP3またはMIDIファイルで演奏をダウンロードできます。
- 曲の削除: 現在の曲を削除することができます。削除前に曲の楽器やドラムなどの楽譜をすべて削除してください。
- 曲に戻る: [曲の操作画面](#page_song_show)に戻ります。

<a name="notations"></a>
## 演奏命令解説
Text Scoreで利用できる演奏命令を解説します。楽譜の入力欄にこの演奏命令を用いたプログラムを記述することで演奏させるのがText Scoreの機能です。

### 音符
一つの音符は入力欄の1行で書きます。「音符」、「ステップ」、「長さ」、「強さ」の組み合わせです。後ろのものほど省略できます。
- 音符: 音程を表すアルファベット(cdefgab)とオクターブ番号の(0～8)で書きます。「c+4」はドのシャープを示します。
- ステップ: 次の音を出すまでの時間で0以上の数値で書きます。48が基準で、四分音符の1拍になります。0を指定すると次の音と同時に音が出るので和音を作ることができます。省略すると48になります。
- 長さ: 音を伸ばしている時間です。ピアノなら鍵盤を押している時間に当たります。数値の意味はステップと同じです。省略するとステップと同じになります。
- 強さ: 音の強さを0～127の範囲で指定します。省略すると100になります。

休符を指定したい場合には音符を「z」と書きます。

なお音符の部分は0から127の数値でも指定でき、c4が60になります。これは主にドラムの場合に用います。番号と打楽器の対応はMIDIのGM規格による定義に従います。Text Scoreでは入力ガイド欄で確認するのが簡単です。

例1 (ドレミ)
```
c4 48
d4 48
e4 48
```

例2 (ドミソの和音)
```
c4 0 48
e4 0 48
g4 48 48
```

### 繰り返し(ループ)
「(」で始まる行と「) 数値」の行で挟まれた範囲を「数値」の回数だけ繰り返します。

例1 (ドドドーを16回繰り返し)
```
(
c4 24
c4 24
c4 48
) 16
```

例2 (ドドドドドーを16回繰り返し)
```
(
(
c4 12
) 4
c4 48
) 16
```

### 演奏の再利用(マクロブロック)
演奏の一部をまとめて名前を付け、それを後から何度も呼び出すことができます。

まず「name (」という行を書きます。ここで「name」はアルファベットで始まる、かつ音符ではない名前で、どんな内容かわかるような名前にします。

その後に必要な演奏命令を書きます。

最後に「)」だけの行を書きます。ここまでがマクロブロックになります。

マクロブロックを書いただけでは何も演奏されません。実際に演奏するには「name()」という行を書きます。ここで「name」は呼び出したいマクロブロックの名前です。

使い方は例を見るのが早いでしょう。

例 (C和音とF和音の組み合わせ)

```
code_c(
(
g3 0 48
c4 0 48
e4 48
) 2
)

code_f(
(
f3 0 48
a3 0 48
c4 48
) 2
)

code_c()
code_c()
code_f()
code_c()
```

### コマンド
演奏命令にはこの他に、細かい設定を変更するコマンドがあります。

たとえば
```
shift 2
```
と書くとその後に続く音符を1音(2半音)ずつ高く演奏します。

以下に一覧を示します。

- shift: その後に続く音符を指定した数値分高くして演奏します。マイナスの数値を指定すると低くなります。数値は1が一つの半音に対応し、12で1オクターブ高くなります。
- row: 「c4」の「4」などオクターブ番号を省略して「c」と書いた時にどのオクターブで演奏するかを指定します。
- step: ステップを省略した場合に48の代わりに使うステップ値を指定します。ステップ12の音符をたくさん書かなければいけない場合に、最初にステップを12に変更してから音程だけを書いて行くことができます。
- gate: stepと同様ですが、長さを省略した場合に48の代わりに使う長さの数値を指定します。
- base: 四分音符1拍として48の代わりに使う数値を指定します。
- vel: 強さを省略したときに100の代わりに使う数値を指定します。0から127で大きいほど強くなります。

## 連絡先等
Text Scoreに関する要望は以下までご連絡ください。

- メール: ushiushix+ts@gmail.com
- Twitter: @ushiushix
- GitHub: https://github.com/ushiushix/text_score/

最終更新:
{{ page.date | date: "%Y年%m月%d日" }}
